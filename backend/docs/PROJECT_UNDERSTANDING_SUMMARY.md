# Context-OS é¡¹ç›®å…¨é¢ç†è§£æ€»ç»“

> **æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-01-XX  
> **é¡¹ç›®å½“å‰ç‰ˆæœ¬**: Unreleased (å¼€å‘ç‰ˆï¼ŒåŸºäº v0.1.0)  
> **é¡¹ç›®çŠ¶æ€**: 95% ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [æŠ€æœ¯æ ˆè¯¦è§£](#æŠ€æœ¯æ ˆè¯¦è§£)
4. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
5. [æ•°æ®æµä¸å¤„ç†æµç¨‹](#æ•°æ®æµä¸å¤„ç†æµç¨‹)
6. [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
7. [é¡¹ç›®ç‰ˆæœ¬æ¼”è¿›](#é¡¹ç›®ç‰ˆæœ¬æ¼”è¿›)
8. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
9. [å…³é”®æ–‡ä»¶ç´¢å¼•](#å…³é”®æ–‡ä»¶ç´¢å¼•)
10. [å¿«é€Ÿä¸Šæ‰‹æŒ‡å—](#å¿«é€Ÿä¸Šæ‰‹æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 äº§å“å®šä½

**Context-OS** æ˜¯ä¸€ä¸ªåŸºäº RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) çš„**ä¼ä¸šçº§æ™ºèƒ½çŸ¥è¯†ç®¡ç†ç³»ç»Ÿ**ï¼Œé€šè¿‡ DeepK æ·±åº¦è®¤çŸ¥æµæ°´çº¿ï¼Œå°†ä¼ ç»Ÿ"æ–‡ä»¶å †æ”¾å¤„"å‡çº§ä¸º"æ„å›¾å‘å°„å°"ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼

- ğŸ“„ **æ™ºèƒ½æ–‡æ¡£ç®¡ç†**: æ”¯æŒ PDFã€DOCXã€TXTã€Markdown ç­‰å¤šç§æ ¼å¼
- ğŸ” **è¯­ä¹‰æ£€ç´¢**: åŸºäºå‘é‡æ•°æ®åº“çš„ä¸‰å±‚é’»å–æ£€ç´¢ç­–ç•¥
- ğŸ’¬ **AI å¯¹è¯**: ç»“åˆæ£€ç´¢ç»“æœçš„æ™ºèƒ½é—®ç­”ï¼Œå¸¦å¼•ç”¨æ ‡æ³¨
- ğŸ“š **çŸ¥è¯†åº“ç®¡ç†**: ç»„ç»‡å’Œç®¡ç†ä¸ªäºº/å›¢é˜ŸçŸ¥è¯†èµ„äº§
- ğŸ§  **K-Type è®¤çŸ¥åˆ†æ**: 5 ç»´è®¤çŸ¥æ‘˜è¦ï¼Œæ·±åº¦ç†è§£æ–‡æ¡£å†…å®¹

### 1.3 ç›®æ ‡ç”¨æˆ·

- ä¼ä¸šçŸ¥è¯†ç®¡ç†å›¢é˜Ÿ
- ç ”å‘å›¢é˜Ÿï¼ˆæŠ€æœ¯æ–‡æ¡£ç®¡ç†ï¼‰
- ä¸ªäººçŸ¥è¯†å·¥ä½œè€…
- éœ€è¦ AI è¾…åŠ©çš„å†…å®¹åˆ›ä½œè€…

---

## 2. æ ¸å¿ƒæ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚â”€â”€â”€â”€â–¶â”‚  Frontend   â”‚â”€â”€â”€â”€â–¶â”‚   Backend   â”‚
â”‚             â”‚â—€â”€â”€â”€â”€â”‚  (Next.js)  â”‚â—€â”€â”€â”€â”€â”‚  (Next.js)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                â”‚                                â”‚
              â–¼                                â–¼                                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  SQLite â”‚                      â”‚  Redis  â”‚                      â”‚ LiteLLM  â”‚
        â”‚  (ç”¨æˆ·) â”‚                      â”‚ (é˜Ÿåˆ—)  â”‚                      â”‚  (AI)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ Worker  â”‚
                                        â”‚(æ–‡æ¡£å¤„ç†)â”‚
                                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                              â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼               â–¼               â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Qdrant  â”‚     â”‚ LiteLLM â”‚     â”‚  Email   â”‚
                        â”‚ (å‘é‡)  â”‚     â”‚  (AI)   â”‚     â”‚ (SMTP)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Docker éƒ¨ç½²æ¶æ„

```
docker-compose.yml
â”œâ”€â”€ backend (ç«¯å£ 3002)      # Next.js API æœåŠ¡
â”œâ”€â”€ worker                   # æ–‡æ¡£å¤„ç† Worker
â”œâ”€â”€ frontend (ç«¯å£ 3003)     # Next.js å‰ç«¯
â”œâ”€â”€ litellm (ç«¯å£ 4410)      # LLM ä»£ç†æœåŠ¡
â”œâ”€â”€ qdrant                   # å‘é‡æ•°æ®åº“
â””â”€â”€ redis                    # ä»»åŠ¡é˜Ÿåˆ—
```

---

## 3. æŠ€æœ¯æ ˆè¯¦è§£

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Next.js** | 16.1.1 | React æ¡†æ¶ (App Router) |
| **React** | 19.2.3 | UI åº“ |
| **TypeScript** | 5.x | ç±»å‹ç³»ç»Ÿ |
| **Tailwind CSS** | 4.x | æ ·å¼ç³»ç»Ÿ |
| **Zustand** | 5.0.10 | çŠ¶æ€ç®¡ç† |
| **Radix UI** | - | æ— æ ·å¼ç»„ä»¶åº“ |
| **Lucide React** | 0.562.0 | å›¾æ ‡åº“ |

### 3.2 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Next.js API Routes** | 16.1.1 | RESTful API |
| **SQLite** | - | å…ƒæ•°æ®å­˜å‚¨ |
| **better-sqlite3** | 12.6.0 | SQLite é©±åŠ¨ |
| **BullMQ** | 5.67.1 | ä»»åŠ¡é˜Ÿåˆ— |
| **IORedis** | 5.9.2 | Redis å®¢æˆ·ç«¯ |
| **Nodemailer** | 6.9.0 | é‚®ä»¶æœåŠ¡ |

### 3.3 AI ä¸å‘é‡æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **LiteLLM** | latest | LLM ç½‘å…³ |
| **Qdrant** | - | å‘é‡æ•°æ®åº“ |
| **@qdrant/js-client-rest** | 1.16.2 | Qdrant å®¢æˆ·ç«¯ |
| **OpenAI SDK** | 6.16.0 | LLM è°ƒç”¨ |

### 3.4 æ”¯æŒçš„ AI æ¨¡å‹

**LLM æ¨¡å‹** (6 ä¸ªå¥åº·):
- qwen-flash (Dashscope)
- qwen3-max (Dashscope)
- deepseek-chat (DeepSeek)
- deepseek-reasoner (DeepSeek)
- Pro/deepseek-ai/DeepSeek-V3.2 (SiliconFlow)
- deepseek-ocr (SiliconFlow)

**Embedding æ¨¡å‹** (éœ€é…ç½®):
- qwen3-embedding-4b (SiliconFlow)

**Reranker æ¨¡å‹** (éœ€é…ç½®):
- qwen3-reranker-4b (SiliconFlow)

---

## 4. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 4.1 ç”¨æˆ·è®¤è¯æ¨¡å— (`lib/auth/`)

**åŠŸèƒ½**:
- JWT Token ç”Ÿæˆå’ŒéªŒè¯ (ä½¿ç”¨ `jose` åº“)
- å¯†ç å“ˆå¸Œ (PBKDF2-SHA256, 600,000 è¿­ä»£)
- Session ç®¡ç† (åŸºäº Cookie)
- è¾“å…¥éªŒè¯ (Zod schema)
- å¯†ç é‡ç½®åŠŸèƒ½ (é‚®ä»¶éªŒè¯)

**å…³é”®æ–‡ä»¶**:
- `lib/auth/jwt.ts` - JWT ç”Ÿæˆ/éªŒè¯
- `lib/auth/password.ts` - å¯†ç å“ˆå¸Œ
- `lib/auth/validation.ts` - Zod è¾“å…¥éªŒè¯
- `app/api/auth/` - è®¤è¯ API è·¯ç”±

### 4.2 æ–‡æ¡£å¤„ç†æ¨¡å— (`lib/processors/`)

**åŠŸèƒ½**:
- æ–‡æ¡£è§£æ (PDF, DOCX, TXT, Markdown)
- K-Type è®¤çŸ¥åˆ†æ (5 ç»´è®¤çŸ¥æ‘˜è¦)
- çˆ¶å­åˆ†å—ç­–ç•¥
  - çˆ¶å—: 1600 å­—ç¬¦, 240 é‡å 
  - å­å—: 420 å­—ç¬¦, 120 é‡å 
- å‘é‡åŒ– (Qwen3-embedding-4b)
- å¼‚æ­¥å¤„ç† (BullMQ é˜Ÿåˆ—)

**å…³é”®æ–‡ä»¶**:
- `lib/processors/document-processor.ts` - ä¸»å¤„ç†æµç¨‹
- `lib/processors/k-type-efficient-vercel.ts` - K-Type è®¤çŸ¥åˆ†æ
- `lib/chunkers/parent-child.ts` - çˆ¶å­åˆ†å—
- `lib/semchunk.ts` - è¯­ä¹‰åˆ†å— (Python)
- `lib/parsers/` - å„ç±»æ–‡ä»¶è§£æå™¨

### 4.3 RAG æ£€ç´¢æ¨¡å— (`lib/rag/`)

**ä¸‰å±‚é’»å–æ£€ç´¢ç­–ç•¥**:

1. **æ–‡æ¡£å±‚æ£€ç´¢**: åœ¨ K-Type æ‘˜è¦ä¸­æœç´¢ï¼Œæ‰¾åˆ°ç›¸å…³æ–‡æ¡£
2. **çˆ¶å—å±‚æ£€ç´¢**: åœ¨è¯¥æ–‡æ¡£çš„çˆ¶å—ä¸­æœç´¢ï¼Œæ‰¾åˆ°ç›¸å…³ç« èŠ‚
3. **å­å—å±‚æ£€ç´¢**: åœ¨çˆ¶å—çš„å­å—ä¸­æœç´¢ï¼Œæ‰¾åˆ°å…·ä½“å†…å®¹

**Qdrant æ•°æ®ç»“æ„**:
- æ–‡æ¡£çº§å‘é‡ç‚¹ (ID: 1,000,000+)
- çˆ¶å—å‘é‡ç‚¹ (ID: 1-999,999)
- å­å—å‘é‡ç‚¹ (ID: 1-999,999)

**å…³é”®æ–‡ä»¶**:
- `lib/rag/retrieval.ts` - æ£€ç´¢é€»è¾‘
- `lib/qdrant.ts` - Qdrant å®¢æˆ·ç«¯
- `lib/embedding.ts` - å‘é‡åµŒå…¥

### 4.4 çŸ¥è¯†åº“ç®¡ç†æ¨¡å—

**åŠŸèƒ½**:
- çŸ¥è¯†åº“ CRUD æ“ä½œ
- æ–‡æ¡£å…³è”ç®¡ç†
- æƒé™æ§åˆ¶
- åˆ†äº«åŠŸèƒ½

**å…³é”®æ–‡ä»¶**:
- `app/api/knowledge-bases/` - çŸ¥è¯†åº“ API
- `lib/stores/kb-store.ts` - çŸ¥è¯†åº“çŠ¶æ€ç®¡ç†
- `components/kb/` - çŸ¥è¯†åº“ç»„ä»¶

### 4.5 èŠå¤©å¯¹è¯æ¨¡å—

**åŠŸèƒ½**:
- å¤šè½®å¯¹è¯æ”¯æŒ
- æµå¼å“åº” (SSE)
- å¼•ç”¨æ ‡æ³¨
- ä¸Šä¸‹æ–‡ç®¡ç†

**å…³é”®æ–‡ä»¶**:
- `app/api/chat/` - èŠå¤© API
- `lib/stores/chat-store.ts` - èŠå¤©çŠ¶æ€ç®¡ç†
- `components/chat/` - èŠå¤©ç»„ä»¶
- `lib/sse/` - SSE æµå¼å“åº”

### 4.6 é‚®ä»¶æœåŠ¡æ¨¡å— (`lib/email/`)

**åŠŸèƒ½**:
- SMTP é‚®ä»¶å‘é€
- å¯†ç é‡ç½®é‚®ä»¶æ¨¡æ¿
- æ”¯æŒ 163ã€QQã€Gmail ç­‰

**å…³é”®æ–‡ä»¶**:
- `lib/email/index.ts` - SMTP å‘é€

### 4.7 æ–‡ä»¶éªŒè¯æ¨¡å— (`lib/utils/file-validation.ts`)

**åŠŸèƒ½**:
- Magic Bytes æ–‡ä»¶ç±»å‹éªŒè¯
- æ–‡ä»¶å¤§å°é™åˆ¶
- æ‰©å±•åç™½åå•éªŒè¯

---

## 5. æ•°æ®æµä¸å¤„ç†æµç¨‹

### 5.1 æ–‡æ¡£ä¸Šä¼ æµç¨‹

```
ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
  â†“
app/api/documents/route.ts
  â†“
lib/utils/file-validation.ts (Magic Bytes éªŒè¯)
  â†“
lib/parsers/ (è§£ææ–‡ä»¶å†…å®¹)
  â†“
Redis é˜Ÿåˆ— (BullMQ)
  â†“
Worker å¼‚æ­¥å¤„ç†
  â†“
lib/processors/document-processor.ts
  â”œâ”€â†’ lib/processors/k-type-efficient-vercel.ts (K-Type è®¤çŸ¥åˆ†æ)
  â”œâ”€â†’ lib/semchunk.ts æˆ– lib/chunkers/parent-child.ts (åˆ†å—)
  â”œâ”€â†’ lib/embedding.ts (å‘é‡åŒ–)
  â””â”€â†’ lib/qdrant.ts (å­˜å‚¨å‘é‡)
  â†“
æ›´æ–° SQLite çŠ¶æ€ (completed)
```

### 5.2 RAG é—®ç­”æµç¨‹

```
ç”¨æˆ·æé—®
  â†“
app/api/chat/sessions/[id]/messages/route.ts
  â†“
lib/rag/retrieval.ts (ä¸‰å±‚é’»å–æ£€ç´¢)
  â”œâ”€â†’ æ–‡æ¡£å±‚æ£€ç´¢ (K-Type æ‘˜è¦)
  â”œâ”€â†’ çˆ¶å—å±‚æ£€ç´¢
  â””â”€â†’ å­å—å±‚æ£€ç´¢
  â†“
ç»„è£…ä¸Šä¸‹æ–‡ (æ–‡æ¡£æ‘˜è¦ + çˆ¶å— + å­å—)
  â†“
lib/llm/ (è°ƒç”¨ LLM)
  â†“
æµå¼å“åº” (SSE) è¿”å›ç»™å‰ç«¯
```

### 5.3 å¯†ç é‡ç½®æµç¨‹

```
ç”¨æˆ·è¯·æ±‚é‡ç½®
  â†“
app/api/auth/reset-request/route.ts
  â”œâ”€â†’ lib/db/queries.ts (ç”Ÿæˆ Token)
  â””â”€â†’ lib/email/ (å‘é€é‚®ä»¶)
  â†“
ç”¨æˆ·ç‚¹å‡»é‚®ä»¶é“¾æ¥
  â†“
app/api/auth/verify-reset-token/route.ts (éªŒè¯ Token)
  â†“
ç”¨æˆ·è¾“å…¥æ–°å¯†ç 
  â†“
app/api/auth/reset-password/route.ts
  â”œâ”€â†’ lib/auth/password.ts (å“ˆå¸Œæ–°å¯†ç )
  â””â”€â†’ lib/db/queries.ts (æ›´æ–°æ•°æ®åº“)
```

---

## 6. éƒ¨ç½²æ¶æ„

### 6.1 æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# æ–¹å¼ä¸€: Docker Compose (æ¨è)
docker-compose -f docker-compose.dev.yml up -d

# æ–¹å¼äºŒ: æœ¬åœ°å¼€å‘
docker-compose up -d qdrant redis litellm
npm run dev
```

**æœåŠ¡ç«¯å£æ˜ å°„**:
- Frontend: http://localhost:3003
- Backend API: http://localhost:3002
- LiteLLM: http://localhost:4410
- Qdrant: 6333 (å†…éƒ¨)
- Redis: 6379 (å†…éƒ¨)

### 6.2 ç”Ÿäº§éƒ¨ç½²é€‰é¡¹

**é€‰é¡¹ 1: è…¾è®¯äº‘å…¨å®¶æ¡¶**
- è½»é‡åº”ç”¨æœåŠ¡å™¨ A (å‰ç«¯): 2C2G, Â¥50/æœˆ
- è½»é‡åº”ç”¨æœåŠ¡å™¨ B (Qdrant): 2C2G, Â¥70/æœˆ
- å¯¹è±¡å­˜å‚¨ COS: Â¥10-20/æœˆ
- æ¶ˆæ¯é˜Ÿåˆ— TDMQ: Â¥20-30/æœˆ
- äº‘å‡½æ•° SCF: Â¥50-100/æœˆ
- **æ€»æˆæœ¬**: Â¥210-370/æœˆ

**é€‰é¡¹ 2: Coolify éƒ¨ç½²**
- æ”¯æŒ Docker Compose ä¸€é”®éƒ¨ç½²
- è‡ªåŠ¨ SSL è¯ä¹¦
- å†…ç½®ç›‘æ§å’Œæ—¥å¿—

**é€‰é¡¹ 3: é˜¿é‡Œäº‘éƒ¨ç½²**
- ECS + OSS + å‡½æ•°è®¡ç®—
- ç±»ä¼¼è…¾è®¯äº‘æ¶æ„

### 6.3 Docker é•œåƒ

- `Dockerfile.backend` - åç«¯ API æœåŠ¡é•œåƒ
- `Dockerfile.worker` - æ–‡æ¡£å¤„ç† Worker é•œåƒ
- `docker-compose.yml` - ç”Ÿäº§ç¯å¢ƒç¼–æ’
- `docker-compose.dev.yml` - å¼€å‘ç¯å¢ƒç¼–æ’

---

## 7. é¡¹ç›®ç‰ˆæœ¬æ¼”è¿›

### 7.1 ç‰ˆæœ¬å†å²

**v0.1.0** (2025-01-27) - åˆå§‹å‘å¸ƒç‰ˆ
- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- æ–‡æ¡£ä¸Šä¼ å’Œå¤„ç†
- RAG èŠå¤©åŠŸèƒ½
- çŸ¥è¯†åº“ç®¡ç†
- å¤šæ¨¡å‹æ”¯æŒ

**Unreleased** (å½“å‰æœ€æ–°ç‰ˆ) - å¼€å‘ç‰ˆ â­
- Docker å¼€å‘ç¯å¢ƒå®Œæ•´æ”¯æŒ
- å¯†ç é‡ç½®åŠŸèƒ½
- SMTP é‚®ä»¶æœåŠ¡
- K-Type æ–‡æ¡£å¤„ç†ä¼˜åŒ–
- ä»£ç å®‰å…¨å®¡è®¡ä¿®å¤
- ç±»å‹å®‰å…¨æ€§å¤§å¹…æå‡
- ç»Ÿä¸€é”™è¯¯å¤„ç†ç³»ç»Ÿ
- LLM é…ç½®ç®€åŒ–
- æ€§èƒ½æµ‹è¯•æ¡†æ¶
- **ç”Ÿäº§å°±ç»ªåº¦**: 95%

### 7.2 ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | v0.1.0 | Unreleased (æœ€æ–°) |
|------|--------|-------------------|
| æ ¸å¿ƒ RAG åŠŸèƒ½ | âœ… | âœ… |
| ç”¨æˆ·è®¤è¯ | âœ… | âœ… å¢å¼º |
| å¯†ç é‡ç½® | âŒ | âœ… |
| é‚®ä»¶æœåŠ¡ | âŒ | âœ… |
| Docker æ”¯æŒ | åŸºç¡€ | âœ… å®Œæ•´ |
| ä»£ç è´¨é‡ | ä¸­ç­‰ | âœ… é«˜ |
| ç±»å‹å®‰å…¨ | ä¸­ç­‰ | âœ… é«˜ |
| æ€§èƒ½æµ‹è¯• | âŒ | âœ… |
| å®‰å…¨åŠ å›º | åŸºç¡€ | âœ… å®Œæ•´ |
| ç”Ÿäº§å°±ç»ªåº¦ | 60% | âœ… 95% |

---

## 8. å¼€å‘è§„èŒƒ

### 8.1 å‰ç«¯å¼€å‘è§„èŒƒ

**å¿…é¡»ä½¿ç”¨**:
- Next.js App Router (ä¸æ˜¯ Pages Router)
- TypeScript strict mode
- Tailwind CSS (ä¸æ˜¯ CSS Modules)
- Zustand (ä¸æ˜¯ Redux)
- Radix UI (ä¸æ˜¯ Material-UI)

**ç¦æ­¢ä½¿ç”¨**:
- JavaScript æ–‡ä»¶ (å¿…é¡» `.ts` æˆ– `.tsx`)
- `any` ç±»å‹ (ç‰¹æ®Šåœºæ™¯éœ€æ³¨é‡Š)
- å†…è”æ ·å¼
- ç›¸å¯¹è·¯å¾„å¯¼å…¥ (ä½¿ç”¨ `@/` åˆ«å)

### 8.2 ä»£ç æäº¤è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·å˜åŠ¨
security: å®‰å…¨ä¿®å¤
```

### 8.3 æ–‡ä»¶å‘½åè§„èŒƒ

| ç±»å‹ | å‘½åè§„èŒƒ | ç¤ºä¾‹ |
|------|---------|------|
| React ç»„ä»¶ | PascalCase | `Button.tsx`, `ChatArea.tsx` |
| å·¥å…·å‡½æ•° | camelCase | `formatDate.ts`, `cn.ts` |
| Hooks | camelCase + `use` å‰ç¼€ | `useAuth.ts`, `useKB.ts` |
| Stores | camelCase + `-store` åç¼€ | `kb-store.ts`, `chat-store.ts` |

---

## 9. å…³é”®æ–‡ä»¶ç´¢å¼•

### 9.1 é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `package.json` | é¡¹ç›®ä¾èµ–å’Œè„šæœ¬ |
| `next.config.ts` | Next.js é…ç½® |
| `tsconfig.json` | TypeScript é…ç½® |
| `tailwind.config.ts` | Tailwind CSS é…ç½® |
| `.env` | ç¯å¢ƒå˜é‡ |
| `litellm-config.yaml` | LiteLLM æ¨¡å‹é…ç½® |
| `docker-compose.yml` | Docker ç¼–æ’ |
| `ecosystem.config.js` | PM2 é…ç½® |

### 9.2 æ ¸å¿ƒä»£ç æ–‡ä»¶

**è®¤è¯æ¨¡å—**:
- `lib/auth/jwt.ts`
- `lib/auth/password.ts`
- `lib/auth/validation.ts`
- `app/api/auth/`

**æ–‡æ¡£å¤„ç†**:
- `lib/processors/document-processor.ts`
- `lib/processors/k-type-efficient-vercel.ts`
- `lib/chunkers/parent-child.ts`
- `lib/parsers/`

**RAG æ£€ç´¢**:
- `lib/rag/retrieval.ts`
- `lib/qdrant.ts`
- `lib/embedding.ts`

**æ•°æ®åº“**:
- `lib/db/schema.ts`
- `lib/db/queries.ts`

**çŠ¶æ€ç®¡ç†**:
- `lib/stores/kb-store.ts`
- `lib/stores/chat-store.ts`
- `lib/stores/document-store.ts`

### 9.3 æ–‡æ¡£æ–‡ä»¶

**æ ¸å¿ƒæ–‡æ¡£**:
- `README.md` - é¡¹ç›®ç®€ä»‹
- `PRD.md` - äº§å“éœ€æ±‚æ–‡æ¡£
- `docs/ARCHITECTURE.md` - æ¶æ„è¯´æ˜
- `docs/CODEMAP.md` - ä»£ç åœ°å›¾
- `docs/DEVELOPMENT.md` - å¼€å‘æŒ‡å—

**éƒ¨ç½²æ–‡æ¡£**:
- `DOCKER_QUICKSTART.md` - Docker å¿«é€Ÿå¼€å§‹
- `docs/CLOUD_DEPLOYMENT_GUIDE.md` - äº‘éƒ¨ç½²æŒ‡å—
- `docs/COOLIFY_DEPLOYMENT.md` - Coolify éƒ¨ç½²
- `docs/TENCENT_CLOUD_SETUP.md` - è…¾è®¯äº‘éƒ¨ç½²

**æŠ€æœ¯æ–‡æ¡£**:
- `docs/FRONTEND_TECH_STACK.md` - å‰ç«¯æŠ€æœ¯æ ˆè§„èŒƒ
- `docs/rag-three-layer-retrieval.md` - RAG ä¸‰å±‚æ£€ç´¢ç­–ç•¥
- `docs/LITELLM_SUCCESS_SUMMARY.md` - LiteLLM é…ç½®æ€»ç»“
- `docs/SECURITY.md` - å®‰å…¨æ§åˆ¶

**æµ‹è¯•æ–‡æ¡£**:
- `docs/PERFORMANCE_TESTING.md` - æ€§èƒ½æµ‹è¯•
- `docs/RAG_TEST_PLAN.md` - RAG æµ‹è¯•è®¡åˆ’
- `docs/E2E_TEST_SUMMARY.md` - E2E æµ‹è¯•æ€»ç»“

---

## 10. å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

### 10.1 ç¯å¢ƒå‡†å¤‡

**å¿…éœ€è½¯ä»¶**:
- Node.js 18+
- Docker & Docker Compose
- Python 3.8+ (ç”¨äº semchunk)

**å¯é€‰è½¯ä»¶**:
- PM2 (ç”Ÿäº§éƒ¨ç½²)
- Nginx (åå‘ä»£ç†)

### 10.2 å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repo-url>
cd context-os

# 2. å®‰è£…ä¾èµ–
npm install

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å†™ API Keys

# 4. å¯åŠ¨æœåŠ¡
docker-compose up -d  # å¯åŠ¨ Qdrant, Redis, LiteLLM
npm run dev           # å¯åŠ¨ Next.js

# 5. è®¿é—®åº”ç”¨
# http://localhost:3000
```

### 10.3 è·å– API Keys

**SiliconFlow** (Embedding æ¨¡å‹):
- æ³¨å†Œ: https://cloud.siliconflow.cn/
- åˆ›å»º API Key
- é…ç½®: `SILICONFLOW_API_KEY`

**Dashscope** (Chat/K-Type æ¨¡å‹):
- æ³¨å†Œ: https://dashscope.aliyun.com/
- åˆ›å»º API Key
- é…ç½®: `DASHSCOPE_API_KEY`

**DeepSeek** (å¯é€‰):
- æ³¨å†Œ: https://platform.deepseek.com/
- åˆ›å»º API Key
- é…ç½®: `DEEPSEEK_API_KEY`

### 10.4 æµ‹è¯•åŠŸèƒ½

```bash
# 1. è¿è¡Œæµ‹è¯•å¥—ä»¶
npm run test

# 2. è¿è¡Œæ€§èƒ½æµ‹è¯•
npm run test:perf:all

# 3. è¿è¡Œ RAG ç«¯åˆ°ç«¯æµ‹è¯•
npx tsx scripts/test-rag-e2e.ts

# 4. æ£€æŸ¥ LiteLLM å¥åº·çŠ¶æ€
curl http://localhost:4000/health
```

### 10.5 å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run build            # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

# æµ‹è¯•
npm run test             # è¿è¡Œæµ‹è¯•
npm run test:integration # é›†æˆæµ‹è¯•
npm run test:perf        # æ€§èƒ½æµ‹è¯•

# Worker
npm run worker           # å¯åŠ¨æ–‡æ¡£å¤„ç† Worker

# ä»£ç æ£€æŸ¥
npm run lint             # ESLint æ£€æŸ¥
npm run typecheck        # TypeScript ç±»å‹æ£€æŸ¥
```

---

## 11. é¡¹ç›®äº®ç‚¹ä¸åˆ›æ–°

### 11.1 æŠ€æœ¯äº®ç‚¹

âœ¨ **K-Type è®¤çŸ¥åˆ†æ**
- 5 ç»´è®¤çŸ¥æ‘˜è¦ (Concept, Procedure, Process, Principle, Fact)
- é«˜å¯†åº¦è¯­ä¹‰ä¿¡æ¯æå–
- æ”¯æŒæ–‡æ¡£çº§å‘é‡æœç´¢

âœ¨ **ä¸‰å±‚é’»å–æ£€ç´¢**
- æ–‡æ¡£å±‚ â†’ çˆ¶å—å±‚ â†’ å­å—å±‚
- ç²¾å‡†å®šä½ï¼Œé¿å…å™ªå£°
- ç¬¦åˆäººç±»è®¤çŸ¥ä¹ æƒ¯

âœ¨ **çˆ¶å­åˆ†å—ç­–ç•¥**
- çˆ¶å—æä¾›ä¸Šä¸‹æ–‡
- å­å—æä¾›ç»†èŠ‚
- å¹³è¡¡æ£€ç´¢ç²¾åº¦å’Œä¸Šä¸‹æ–‡å®Œæ•´æ€§

âœ¨ **LiteLLM ç»Ÿä¸€ç½‘å…³**
- æ”¯æŒå¤šä¸ª LLM æä¾›å•†
- ç»Ÿä¸€ API æ¥å£
- ç®€åŒ–æ¨¡å‹åˆ‡æ¢

âœ¨ **ç±»å‹å®‰å…¨**
- TypeScript strict mode
- æ¶ˆé™¤ä¸å®‰å…¨ç±»å‹æ–­è¨€
- å®Œæ•´çš„ç±»å‹å®šä¹‰

### 11.2 æ¶æ„ä¼˜åŠ¿

ğŸ—ï¸ **æ¨¡å—åŒ–è®¾è®¡**
- æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- æ˜“äºç»´æŠ¤å’Œæ‰©å±•
- æ”¯æŒç‹¬ç«‹éƒ¨ç½²

ğŸ—ï¸ **å¼‚æ­¥å¤„ç†**
- BullMQ ä»»åŠ¡é˜Ÿåˆ—
- Worker ç‹¬ç«‹è¿›ç¨‹
- æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦

ğŸ—ï¸ **Docker åŒ–éƒ¨ç½²**
- ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
- ç¯å¢ƒä¸€è‡´æ€§
- æ˜“äºæ‰©å±•

ğŸ—ï¸ **å¤šäº‘æ”¯æŒ**
- è…¾è®¯äº‘å…¨å®¶æ¡¶
- é˜¿é‡Œäº‘
- Coolify è‡ªæ‰˜ç®¡

---

## 12. å·²çŸ¥é—®é¢˜ä¸æ”¹è¿›æ–¹å‘

### 12.1 å½“å‰é˜»å¡é¡¹

â³ **éœ€è¦é…ç½®çœŸå® API Keys** (30-60 åˆ†é’Ÿ)
- SiliconFlow API Key (Embedding)
- Dashscope API Key (Chat/K-Type)
- DeepSeek API Key (å¯é€‰)

### 12.2 å¾…ä¼˜åŒ–é¡¹ (P2)

ğŸ”§ **æ€§èƒ½ä¼˜åŒ–**
- Qdrant æ‰¹é‡æ’å…¥ä¼˜åŒ–
- ç¼“å­˜ç­–ç•¥å®æ–½
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

ğŸ”§ **åŠŸèƒ½å¢å¼º**
- CSRF ä¿æŠ¤
- æ›´å¤šæ–‡ä»¶æ ¼å¼æ”¯æŒ
- å¤šè¯­è¨€æ”¯æŒ

ğŸ”§ **æµ‹è¯•å®Œå–„**
- å•å…ƒæµ‹è¯•è¦†ç›–æ‰©å±•
- E2E æµ‹è¯•åœºæ™¯å¢åŠ 
- æ€§èƒ½å›å½’æµ‹è¯•

ğŸ”§ **æ–‡æ¡£å®Œå–„**
- JSDoc æ³¨é‡Šè¡¥å……
- API æ–‡æ¡£ç”Ÿæˆ
- ç”¨æˆ·æ‰‹å†Œç¼–å†™

---

## 13. ç›¸å…³èµ„æº

### 13.1 å®˜æ–¹æ–‡æ¡£

- [Next.js 16 Docs](https://nextjs.org/docs)
- [React 19 Docs](https://react.dev)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Tailwind CSS 4](https://tailwindcss.com/docs)
- [Qdrant Docs](https://qdrant.tech/documentation/)
- [LiteLLM Docs](https://docs.litellm.ai/)

### 13.2 é¡¹ç›®æ–‡æ¡£

- ğŸ“š [å®Œæ•´æ–‡æ¡£ç›®å½•](./README.md)
- ğŸ—ï¸ [æ¶æ„è¯´æ˜](./ARCHITECTURE.md)
- ğŸ’» [å¼€å‘æŒ‡å—](./DEVELOPMENT.md)
- ğŸ—ºï¸ [ä»£ç åœ°å›¾](./CODEMAP.md)
- ğŸ“ [æ›´æ–°æ—¥å¿—](./CHANGELOG.md)

### 13.3 ç¤¾åŒºèµ„æº

- GitHub Issues: é—®é¢˜åé¦ˆ
- GitHub Discussions: æŠ€æœ¯è®¨è®º
- é¡¹ç›® Wiki: çŸ¥è¯†åº“

---

## 14. æ€»ç»“

### 14.1 é¡¹ç›®æˆç†Ÿåº¦

**Context-OS** å½“å‰å¤„äº **95% ç”Ÿäº§å°±ç»ª** çŠ¶æ€ï¼š

âœ… **å·²å®Œæˆ**:
- æ ¸å¿ƒ RAG åŠŸèƒ½å®Œæ•´
- ä»£ç è´¨é‡è¾¾åˆ°ç”Ÿäº§æ ‡å‡†
- å®Œæ•´çš„æµ‹è¯•æ¡†æ¶
- Docker åŒ–éƒ¨ç½²
- å®‰å…¨åŠ å›º
- æ€§èƒ½ä¼˜åŒ–

â³ **å¾…å®Œæˆ**:
- é…ç½®çœŸå® API Keys (30-60 åˆ†é’Ÿ)
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²éªŒè¯

### 14.2 æ¨èä½¿ç”¨åœºæ™¯

âœ… **é€‚åˆ**:
- ä¼ä¸šçŸ¥è¯†ç®¡ç†
- æŠ€æœ¯æ–‡æ¡£ç®¡ç†
- ä¸ªäººçŸ¥è¯†åº“
- AI è¾…åŠ©å†…å®¹åˆ›ä½œ

âŒ **ä¸é€‚åˆ**:
- å®æ—¶åä½œç¼–è¾‘
- å¤§è§„æ¨¡å…¬å¼€çŸ¥è¯†åº“
- ç§»åŠ¨ç«¯åŸç”Ÿåº”ç”¨

### 14.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¯åš** (ä»Šå¤©):
   - é…ç½® API Keys
   - å¯åŠ¨æœåŠ¡æµ‹è¯•
   - ä¸Šä¼ æµ‹è¯•æ–‡æ¡£

2. **çŸ­æœŸ** (æœ¬å‘¨):
   - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
   - æ€§èƒ½åŸºå‡†æµ‹è¯•
   - éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

3. **ä¸­æœŸ** (æœ¬æœˆ):
   - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
   - ç”¨æˆ·åŸ¹è®­
   - ç›‘æ§å’Œä¼˜åŒ–

---

**æ–‡æ¡£ç»´æŠ¤**: Context-OS å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-01-XX
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0

---

## é™„å½•

### A. ç¯å¢ƒå˜é‡å®Œæ•´åˆ—è¡¨

```bash
# ========== LLM æœåŠ¡ ==========
LITELLM_BASE_URL=http://localhost:4000/v1
LITELLM_API_KEY=local-dev
KTYPE_MODEL=qwen-flash
EMBEDDING_MODEL=qwen3-embedding-4b
RERANKER_MODEL=qwen3-reranker-4b

# ========== API Keys ==========
SILICONFLOW_API_KEY=sk-your-key
DASHSCOPE_API_KEY=sk-your-key
DEEPSEEK_API_KEY=sk-your-key

# ========== æ•°æ®åº“ ==========
DATABASE_URL=file:data/context-os.db
QDRANT_URL=http://localhost:6333

# ========== Redis ==========
REDIS_HOST=localhost
REDIS_PORT=6379

# ========== è®¤è¯ ==========
JWT_SECRET=your-secret-key-change-in-production
COOKIE_SECURE=false

# ========== é‚®ä»¶ (SMTP) ==========
SMTP_HOST=smtp.163.com
SMTP_PORT=465
SMTP_SECURE=true
SMTP_USER=your-email@163.com
SMTP_PASS=your-smtp-password
SMTP_FROM=Context-OS <your-email@163.com>

# ========== æ–‡æ¡£å¤„ç† ==========
KTYPE_MAX_TOKENS=500000
KTYPE_MAX_CHARS=990000
DOC_CHUNK_SIZE=2400
DOC_CHUNK_OVERLAP=300
PARENT_CHUNK_SIZE=1600
```

### B. å¸¸è§é—®é¢˜ FAQ

**Q: å¦‚ä½•åˆ‡æ¢ LLM æ¨¡å‹ï¼Ÿ**
A: ä¿®æ”¹ `litellm-config.yaml` ä¸­çš„æ¨¡å‹é…ç½®ï¼Œé‡å¯ LiteLLM æœåŠ¡ã€‚

**Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ**
A: å¤‡ä»½ `data/context-os.db` (SQLite) å’Œ `qdrant_storage/` (Qdrant)ã€‚

**Q: å¦‚ä½•æ‰©å±•å‘é‡æ•°æ®åº“å®¹é‡ï¼Ÿ**
A: å¢åŠ  Qdrant æœåŠ¡å™¨å†…å­˜ï¼Œæˆ–ä½¿ç”¨ Qdrant Cloudã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°çš„æ–‡ä»¶æ ¼å¼æ”¯æŒï¼Ÿ**
A: åœ¨ `lib/parsers/` ä¸­æ·»åŠ æ–°çš„è§£æå™¨ï¼Œæ›´æ–° `file-validation.ts`ã€‚

**Q: å¦‚ä½•ä¼˜åŒ–æ£€ç´¢æ€§èƒ½ï¼Ÿ**
A: è°ƒæ•´ Qdrant ç´¢å¼•å‚æ•°ï¼Œä¼˜åŒ–åˆ†å—ç­–ç•¥ï¼Œä½¿ç”¨ Reranker æ¨¡å‹ã€‚

---

**ğŸ‰ æ­å–œï¼ä½ å·²ç»å…¨é¢ç†è§£äº† Context-OS é¡¹ç›®ï¼**


