# Context-OS æ€§èƒ½æµ‹è¯•å¥—ä»¶

å®Œæ•´çš„åç«¯æ€§èƒ½ã€ç¨³å®šæ€§å’Œå‹åŠ›æµ‹è¯•å·¥å…·é›†ã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æµ‹è¯•ç±»å‹](#æµ‹è¯•ç±»å‹)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [æµ‹è¯•ç›®æ ‡](#æµ‹è¯•ç›®æ ‡)
- [ç»“æœåˆ†æ](#ç»“æœåˆ†æ)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### è¿è¡Œæ‰€æœ‰æ€§èƒ½æµ‹è¯•

```bash
npm run test:perf:all
```

### è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•

```bash
# å“åº”æ—¶é—´æµ‹è¯•
npm run test:perf:response

# å¹¶å‘è´Ÿè½½æµ‹è¯•
npm run test:perf:load

# å†…å­˜æ³„æ¼æµ‹è¯•
npm run test:perf:memory

# å‹åŠ›æµ‹è¯•
npm run test:perf:stress
```

## ğŸ“Š æµ‹è¯•ç±»å‹

### 1. å“åº”æ—¶é—´æµ‹è¯• (Response Time Tests)

æµ‹è¯•å„ API ç«¯ç‚¹çš„å“åº”æ€§èƒ½ï¼Œå»ºç«‹æ€§èƒ½åŸºå‡†ã€‚

**æµ‹è¯•ç«¯ç‚¹:**
- `GET /api/documents` - æ–‡æ¡£åˆ—è¡¨
- `GET /api/knowledge-bases` - çŸ¥è¯†åº“åˆ—è¡¨
- `POST /api/search` - æœç´¢æ¥å£
- `GET /api/chat/sessions` - èŠå¤©ä¼šè¯

**æ€§èƒ½ç›®æ ‡:**
- âœ… å¹³å‡å“åº”æ—¶é—´ < 500ms
- âœ… P95 å“åº”æ—¶é—´ < 1000ms
- âœ… P99 å“åº”æ—¶é—´ < 2000ms

**ç¤ºä¾‹è¾“å‡º:**
```
ğŸ§ª æµ‹è¯•: æ–‡æ¡£åˆ—è¡¨è·å–
   ç«¯ç‚¹: GET /api/documents

ğŸ“Š æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  æœ€å°å€¼:     45ms
  æœ€å¤§å€¼:     1234ms
  å¹³å‡å€¼:     234ms
  æ ‡å‡†å·®:     156ms

  ç™¾åˆ†ä½æ•°:
    P50:      198ms
    P75:      312ms
    P90:      456ms
    P95:      678ms
    P99:      1123ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… æ€§èƒ½ç›®æ ‡éªŒè¯:
  âœ… å¹³å‡å“åº”æ—¶é—´ < 500ms
  âœ… P95 å“åº”æ—¶é—´ < 1000ms
  âŒ P99 å“åº”æ—¶é—´ < 2000ms

âš ï¸  æ€§èƒ½ç›®æ ‡æœªè¾¾æˆï¼Œå¯èƒ½éœ€è¦ä¼˜åŒ–
```

### 2. å¹¶å‘è´Ÿè½½æµ‹è¯• (Load Tests)

æµ‹è¯•ç³»ç»Ÿåœ¨ä¸åŒå¹¶å‘çº§åˆ«ä¸‹çš„è¡¨ç°ã€‚

**æµ‹è¯•åœºæ™¯:**
- æ¸è¿›å¼å¢åŠ å¹¶å‘: 1, 5, 10, 25, 50, 100 ç”¨æˆ·
- æŒç»­æ—¶é—´: æ¯ä¸ªçº§åˆ« 30 ç§’
- æµ‹è¯•ç«¯ç‚¹: `/api/documents`

**æ€§èƒ½ç›®æ ‡:**
- âœ… æ”¯æŒ 50 å¹¶å‘ç”¨æˆ·
- âœ… ååé‡ > 100 req/s
- âœ… é”™è¯¯ç‡ < 1%

**ç¤ºä¾‹è¾“å‡º:**
```
ğŸ”¥ æµ‹è¯•å¹¶å‘çº§åˆ«: 50 ç”¨æˆ·
   ååé‡:     145.3 req/s
   å¹³å‡å»¶è¿Ÿ:   345ms
   é”™è¯¯ç‡:     0%

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  å¹¶å‘æ•°    ååé‡         å¹³å‡å»¶è¿Ÿ        é”™è¯¯ç‡    çŠ¶æ€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1         12.5 req/s    45ms           0%        âœ… é€šè¿‡
  5         58.3 req/s    89ms           0%        âœ… é€šè¿‡
  10        112.4 req/s   145ms          0%        âœ… é€šè¿‡
  25        156.7 req/s   234ms          0%        âœ… é€šè¿‡
  50        145.3 req/s   345ms          0%        âœ… é€šè¿‡
  100       98.2 req/s    987ms          2.3%      âŒ å¤±è´¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“ˆ æ€§èƒ½åˆ†æ:
  æœ€å¤§ååé‡: 156.7 req/s (åœ¨ 25 å¹¶å‘æ—¶)
  æ¨èå¹¶å‘æ•°: 25 ç”¨æˆ· (æ€§èƒ½æœ€ä¼˜)
```

### 3. å†…å­˜æ³„æ¼æµ‹è¯• (Memory Leak Tests)

æ£€æµ‹ç³»ç»Ÿæ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ã€‚

**æµ‹è¯•åœºæ™¯:**
- LLM å®¢æˆ·ç«¯é‡å¤åˆ›å»º (100 æ¬¡)
- Qdrant æ‰¹é‡æ’å…¥æ“ä½œ (50 æ¬¡)
- æ–‡æ¡£å¤„ç†æ“ä½œ (50 æ¬¡)

**å†…å­˜ç›®æ ‡:**
- âœ… å †å†…å­˜å¢é•¿ < 50%
- âœ… æœ€ç»ˆå †å†…å­˜ < 2GB

**ç¤ºä¾‹è¾“å‡º:**
```
ğŸ§ª æµ‹è¯•: LLM å®¢æˆ·ç«¯é‡å¤åˆ›å»º
   è¿­ä»£æ¬¡æ•°: 100

ğŸ“Š å†…å­˜å˜åŒ–è¶‹åŠ¿:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   è¿­ä»£    0: å †      45.23 MB    RSS      78.45 MB
   è¿­ä»£   10: å †      48.67 MB    RSS      82.12 MB
   è¿­ä»£   20: å †      52.34 MB    RSS      85.67 MB
   ...
   è¿­ä»£  100: å †      67.89 MB    RSS     102.34 MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ’¾ å†…å­˜ä½¿ç”¨æƒ…å†µ:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  å †ä½¿ç”¨:        45.23 MB â†’  67.89 MB (+22.66 MB, 50.1%)
  å †æ€»é‡:        56.78 MB â†’  78.90 MB (+22.12 MB, 39.0%)
  RSS:           78.45 MB â†’ 102.34 MB (+23.89 MB, 30.4%)
  å¤–éƒ¨:          1.23 MB  â†’  1.45 MB  (+0.22 MB, 17.9%)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ” å†…å­˜æ³„æ¼åˆ†æ:
   âš ï¸  è­¦å‘Š: å †å†…å­˜å¢é•¿ 50.1%
   å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œå»ºè®®æ£€æŸ¥ä»£ç 
```

### 4. å‹åŠ›æµ‹è¯• (Stress Tests)

æµ‹è¯•ç³»ç»Ÿåœ¨æç«¯è´Ÿè½½ä¸‹çš„è¡¨ç°ã€‚

**æµ‹è¯•åœºæ™¯:**
- æé™å¹¶å‘: 100, 200, 500 ç”¨æˆ·
- å¤§æ–‡æ¡£å¤„ç†: 10KB, 100KB, 1MB, 5MB
- é•¿æ—¶é—´è¿è¡Œ: æŒç»­ 60 ç§’

**ç¤ºä¾‹è¾“å‡º:**
```
ğŸ”¥ æé™å¹¶å‘å‹åŠ›æµ‹è¯•
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

æµ‹è¯•å¹¶å‘çº§åˆ«: 100
   ååé‡:     123.4 req/s
   å¹³å‡å»¶è¿Ÿ:   812ms
   é”™è¯¯ç‡:     0%
   è¶…æ—¶ç‡:     0%

æµ‹è¯•å¹¶å‘çº§åˆ«: 200
   ååé‡:     98.7 req/s
   å¹³å‡å»¶è¿Ÿ:   1567ms
   é”™è¯¯ç‡:     3.2%
   è¶…æ—¶ç‡:     1.5%
   âš ï¸  åœ¨ 200 å¹¶å‘æ—¶ç³»ç»Ÿå¼€å§‹å‡ºç°ä¸ç¨³å®š

ğŸ’¥ ç³»ç»Ÿåœ¨ 500 å¹¶å‘æ—¶å´©æºƒæˆ–æ— æ³•å“åº”
```

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆé»˜è®¤é…ç½®ï¼‰
npm run test:perf

# è‡ªå®šä¹‰æµ‹è¯•æ—¶é•¿ï¼ˆç§’ï¼‰
tsx scripts/test-performance/index.ts --duration=60

# è‡ªå®šä¹‰å¹¶å‘è¿æ¥æ•°
tsx scripts/test-performance/index.ts --connections=25

# ç»„åˆä½¿ç”¨
tsx scripts/test-performance/index.ts --type=load --duration=60 --connections=50
```

### åœ¨ CI/CD ä¸­ä½¿ç”¨

```yaml
# .github/workflows/performance.yml
name: Performance Tests

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  performance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Start development server
        run: npm run dev &
        env:
          PORT: 3000

      - name: Wait for server
        run: sleep 10

      - name: Run performance tests
        run: npm run test:perf:response
        env:
          NEXT_PUBLIC_APP_URL: http://localhost:3000
```

## ğŸ“ˆ æµ‹è¯•ç›®æ ‡

### æ€§èƒ½åŸºçº¿

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| API å¹³å‡å“åº”æ—¶é—´ | < 500ms | æ‰€æœ‰ API ç«¯ç‚¹ |
| API P95 å“åº”æ—¶é—´ | < 1000ms | 95% è¯·æ±‚ |
| API P99 å“åº”æ—¶é—´ | < 2000ms | 99% è¯·æ±‚ |
| å¹¶å‘ç”¨æˆ·æ”¯æŒ | 50+ | ç¨³å®šè¿è¡Œ |
| æœ€å¤§ååé‡ | > 100 req/s | å•ä¸ª API ç«¯ç‚¹ |
| é”™è¯¯ç‡ | < 1% | æ­£å¸¸è´Ÿè½½ä¸‹ |
| å †å†…å­˜ä½¿ç”¨ | < 2GB | ç¨³å®šçŠ¶æ€ |
| å†…å­˜å¢é•¿ | < 50% | é•¿æ—¶é—´è¿è¡Œ |

## ğŸ” ç»“æœåˆ†æ

### æ€§èƒ½æŠ¥å‘Šè§£è¯»

1. **å“åº”æ—¶é—´ç™¾åˆ†ä½æ•°**
   - P50: ä¸­ä½æ•°ï¼Œ50% è¯·æ±‚çš„å“åº”æ—¶é—´
   - P95: 95% è¯·æ±‚çš„å“åº”æ—¶é—´ï¼ˆç”¨æˆ·ä½“éªŒå…³é”®æŒ‡æ ‡ï¼‰
   - P99: 99% è¯·æ±‚çš„å“åº”æ—¶é—´ï¼ˆæç«¯æƒ…å†µï¼‰

2. **ååé‡**
   - æ¯ç§’å¤„ç†çš„è¯·æ±‚æ•°
   - è¶Šé«˜è¡¨ç¤ºç³»ç»Ÿæ€§èƒ½è¶Šå¥½
   - è¿‡ä½å¯èƒ½è¡¨ç¤ºå­˜åœ¨ç“¶é¢ˆ

3. **é”™è¯¯ç‡**
   - å¤±è´¥è¯·æ±‚çš„ç™¾åˆ†æ¯”
   - åŒ…æ‹¬è¶…æ—¶ã€è¿æ¥å¤±è´¥ã€HTTP é”™è¯¯ç­‰
   - ç†æƒ³æƒ…å†µä¸‹åº”è¯¥ä¸º 0%

4. **å†…å­˜ä½¿ç”¨**
   - å †å†…å­˜: V8 åˆ†é…çš„å†…å­˜
   - RSS: å¸¸é©»å†…å­˜å¤§å°
   - å¤–éƒ¨: C++ å¯¹è±¡ä½¿ç”¨çš„å†…å­˜
   - æŒç»­å¢é•¿å¯èƒ½è¡¨ç¤ºå†…å­˜æ³„æ¼

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

æ ¹æ®æµ‹è¯•ç»“æœï¼Œå¯èƒ½éœ€è¦ä¼˜åŒ–çš„æ–¹é¢ï¼š

1. **å“åº”æ—¶é—´æ…¢**
   - æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡
   - æ·»åŠ ç¼“å­˜å±‚
   - ä¼˜åŒ–ç®—æ³•å¤æ‚åº¦
   - è€ƒè™‘ä½¿ç”¨ CDN

2. **ååé‡ä½**
   - å¢åŠ æœåŠ¡å™¨èµ„æº
   - å®æ–½è¿æ¥æ± 
   - å¯ç”¨å‹ç¼©
   - ä½¿ç”¨è´Ÿè½½å‡è¡¡

3. **å†…å­˜å¢é•¿**
   - æ£€æŸ¥å†…å­˜æ³„æ¼
   - ä¼˜åŒ–æ•°æ®ç»“æ„
   - å®æ–½ç¼“å­˜æ¸…ç†ç­–ç•¥
   - ä½¿ç”¨æµå¼å¤„ç†

4. **é”™è¯¯ç‡é«˜**
   - æ£€æŸ¥é”™è¯¯æ—¥å¿—
   - å®æ–½é‡è¯•æœºåˆ¶
   - æ·»åŠ ç†”æ–­å™¨
   - ä¼˜åŒ–è¶…æ—¶è®¾ç½®

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æµ‹è¯•å¤±è´¥ï¼Œæç¤º "ECONNREFUSED"**

A: ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ:
```bash
npm run dev
```

**Q: å†…å­˜æµ‹è¯•ä¸å‡†ç¡®**

A: ä½¿ç”¨ `--expose-gc` æ ‡å¿—ä»¥å¯ç”¨åƒåœ¾å›æ”¶:
```bash
npm run test:perf:memory
```

**Q: å‹åŠ›æµ‹è¯•å¯¼è‡´æœåŠ¡å™¨å´©æºƒ**

A: è¿™æ˜¯é¢„æœŸè¡Œä¸ºã€‚å‹åŠ›æµ‹è¯•ä¼šæ¨åˆ°æé™ã€‚å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ç¡®ä¿æœåŠ¡å™¨é…ç½®åˆç†ã€‚

**Q: æµ‹è¯•ç»“æœæ³¢åŠ¨å¾ˆå¤§**

A: ç¡®ä¿æµ‹è¯•ç¯å¢ƒç¨³å®š:
- å…³é—­å…¶ä»–åº”ç”¨ç¨‹åº
- ä½¿ç”¨å›ºå®šç½‘ç»œ
- å¤šæ¬¡è¿è¡Œå–å¹³å‡å€¼
- ç¡®ä¿æœåŠ¡å™¨èµ„æºå……è¶³

## ğŸ“ æ€§èƒ½æµ‹è¯•æœ€ä½³å®è·µ

1. **å»ºç«‹åŸºçº¿**
   - åœ¨ä¼˜åŒ–å‰å…ˆè¿è¡Œæµ‹è¯•ï¼Œå»ºç«‹æ€§èƒ½åŸºçº¿
   - è®°å½•æµ‹è¯•ç¯å¢ƒå’Œé…ç½®

2. **å®šæœŸæµ‹è¯•**
   - æ¯æ¬¡é‡å¤§æ›´æ”¹åè¿è¡Œæµ‹è¯•
   - åœ¨ CI/CD ä¸­é›†æˆæ€§èƒ½æµ‹è¯•
   - å®šæœŸè¿›è¡Œå®Œæ•´çš„æ€§èƒ½è¯„ä¼°

3. **çœŸå®åœºæ™¯**
   - ä½¿ç”¨çœŸå®çš„æ•°æ®å’Œè´Ÿè½½
   - æ¨¡æ‹Ÿå®é™…ä½¿ç”¨æ¨¡å¼
   - è€ƒè™‘å³°å€¼å’Œæ­£å¸¸è´Ÿè½½

4. **æŒç»­ä¼˜åŒ–**
   - æ ¹æ®æµ‹è¯•ç»“æœè¿›è¡Œä¼˜åŒ–
   - é‡æ–°æµ‹è¯•éªŒè¯æ”¹è¿›
   - è®°å½•ä¼˜åŒ–æ•ˆæœ

5. **ç›‘æ§ç”Ÿäº§**
   - åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›‘æ§æ€§èƒ½æŒ‡æ ‡
   - ä¸æµ‹è¯•ç»“æœå¯¹æ¯”
   - åŠæ—¶å‘ç°æ€§èƒ½é€€åŒ–

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åç«¯æµ‹è¯•è®¡åˆ’](../../docs/BACKEND_TEST_PLAN.md) - å®Œæ•´çš„æµ‹è¯•ç­–ç•¥
- [åç«¯æ¸…ç†æ€»ç»“](../../docs/BACKEND_CLEANUP_FINAL_SUMMARY.md) - ä»£ç è´¨é‡æ”¹è¿›
- [API æ–‡æ¡£](../../docs/API.md) - API ç«¯ç‚¹è¯´æ˜

---

**ç»´æŠ¤è€…:** Claude Code
**åˆ›å»ºæ—¶é—´:** 2025-01-14
**æœ€åæ›´æ–°:** 2025-01-14
